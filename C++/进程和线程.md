###### 进程和线程

​		感觉这是一个面试必问的问题，前几天和同事聊天，再次谈到这个事情，脑袋里面第一反应就是上学的时候那句经典名言“进程是操作系统分配资源的单位，线程是系统调度的单位，进程与进程之间的资源不共享，线程与线程之间的资源可以共享”。常记于心的一句话却显得是多么的苍白，一个“虚”！所以今天打算专门来总结一下线程和进程相关的内容。

###### 首先，什么是进程？什么又是线程呢？进程和线程之间的关系又是什么？

​		进程就是一个执行程序，比如windows的exe开始运行的时候就是一个进程，进程又是由线程组合而来，为什么这么说呢，因为每个进程都有一个主线程，当这个主线程结束了，或者执行完成也就意味着这个进程也就执行完成了。每个线程都是在完成不同的任务，那么每个线程执行的函数就是一个小任务，而每个程序语句就是完成小任务的每个步骤。

###### 为什么进程与进程之间的资源不共享？

​		说到资源，那它肯定会有一个存放的位置，也就是物理内存和虚拟内存。物理内存就是你计算机上的硬盘，虚拟内存就是你电脑的内存条。硬盘上的资源是永久保存的，而内存条上的东西都是临时的，你一关机它就没了。

​		32位操作系统会给每个进程分配2^32位的寻址空间，其中高1G为内核空间，低3G为用户空间。64位的操作系统一般给每个进程分配2^48位的寻址空间。后面主要都以32位操作系统来说，也就是每个进程的寻址空间在[0,2^32)之间。很显然这一下子就暴露了进程与进程之间的资源不共享的原因，因为计算机运行时都是用的虚拟内存，就算你知道了进程A的某个资源的虚拟地址，但是你在进程B中去相应的地址却不能取到对应的值。

###### 线程与线程之间的共享

​		线程和线程之间有哪些资源是共享的呢，首先我们要知道在一个进程运行时会有哪些区域，一般来说一个程序运行时内存中会包含数据区、代码区、堆区、栈区，动态链接区。其中数据区主要用来保存全所谓的全局变量，静态变量等。代码区中主要可执行的机器指令，这些指令就是我们写的代码经过编译之后得到的东西。堆区，是用来保存程序中动态分配的数据成员，这些成员的声明周期需要我们程序猿自己来进行管理。

​		栈区主要放什么东西呢？来回到我们最初的那句名言，其中有一句话“线程是系统调度的最小单元”。现在我们来看看系统是怎么进行调度的。我们可以在编译器中查看到栈取的内容，你可以看到里面其实反应了你函数调用的顺序。当进入一个函数的时候，把这个函数信息压入栈，当该函数执行完成之后将它出栈。现在CPU中有一个核core1，它正在执行你的函数A，你函数A里面写了sleep(100000)，此时这个core1该怎么办，它不能一直在那里歇着，等着你sleep结束吧，毕竟操作系统中有那么多事情要做。这个时候core1会把你这个函数当前的信息保存到寄存器中，然后就去干别的事情了，寄存器中会保存你当前函数的局部变量、参数、返回地址等信息，这样core1等你sleep完之后再回来接着继续执行就ok。

​	同一个数据空间内，大家用的同一个寻址空间，映射的是相同的物理地址，自然而然只要线程A知道线程B中某个变量的数据虚拟地址，就能够访问到这个虚拟地址映射的值。所以线程和线程之间的资源就是共享的。